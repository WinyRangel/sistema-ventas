import{a as jt}from"./chunk-UFWWA4DI.js";import{a as kt}from"./chunk-GZTO2K2W.js";import{a as E}from"./chunk-J545SRXK.js";import{a as X,c as ct,d as dt,e as It,f as Ut,g as Ft,h as Tt,i as Rt,j as Pt,k as Nt,l as $t}from"./chunk-ZETOQEDU.js";import{$ as et,Aa as yt,Ba as Dt,Ca as F,D as J,Da as Ot,E as U,H as K,W as Y,X as Z,Y as tt,Z as f,aa as it,ca as ot,da as rt,ea as nt,fa as at,ga as mt,ha as lt,ia as st,ma as pt,na as ut,oa as ft,pa as ht,qa as gt,ra as Ct,sa as _t,ta as bt,ua as Mt,va as vt,wa as xt,xa as Et,ya as St,za as wt}from"./chunk-OM5FE3UL.js";import{a as Q,l as k}from"./chunk-BBVDCCLH.js";import"./chunk-IX6G3U3V.js";import{$b as H,Cb as r,Db as n,E as _,Eb as u,Fb as b,Gb as M,Ib as V,Lb as v,Lc as z,Mc as G,Nb as x,Oc as W,Rb as B,Sb as q,Tb as L,Vb as a,W as C,Wb as S,Xb as g,Za as l,_a as h,aa as A,ba as D,fa as P,j as y,ka as O,la as I,q as j,rb as d,ta as N,tb as p,ua as $}from"./chunk-XDC2YFKR.js";var R=(()=>{let e=class e{constructor(i,o){this.snackBar=i,this.http=o}listarUsuarios(){return this.http.get(`${E.API_URL}/usuarios`,{headers:{requireToken:"true"}}).pipe(_(i=>this.handlerError(i)))}listarRoles(){return this.http.get(`${E.API_URL}/general/roles`,{headers:{requireToken:"true"}}).pipe(_(i=>this.handlerError(i)))}insertarUsuario(i){return this.http.post(`${E.API_URL}/usuarios`,i,{headers:{requireToken:"true"}}).pipe(_(o=>this.handlerError(o)))}actualizarUsuario(i){return this.http.put(`${E.API_URL}/usuarios`,i,{headers:{requireToken:"true"}}).pipe(_(o=>this.handlerError(o)))}eliminarUsuario(i){return this.http.delete(`${E.API_URL}/usuarios/${i}`,{headers:{requireToken:"true"}}).pipe(_(o=>this.handlerError(o)))}handlerError(i){console.log(i);var o="Ocurri\xF3 un error";return i.error&&(i.error.message?o=i.error.message:o="Ocurri\xF3 un error"),this.snackBar.open(o,"",{duration:3e3}),j(()=>new Error(o))}};e.\u0275fac=function(o){return new(o||e)(P(X),P(Q))},e.\u0275prov=A({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function Gt(t,e){if(t&1&&(r(0,"mat-option",14),a(1),n()),t&2){let s=e.$implicit;p("value",s.cveRol),l(),g(" ",s.descripcion+" - "+s.clave," ")}}function Wt(t,e){if(t&1&&(r(0,"mat-form-field",2)(1,"mat-label"),a(2,"Contrase\xF1a"),n(),u(3,"input",15),r(4,"mat-error"),a(5),n()()),t&2){let s=x();l(5),g(" ",s.baseForm.getErrorMessage(s.userForm.get("password"))," ")}}function Qt(t,e){if(t&1&&(r(0,"mat-form-field",2)(1,"mat-label"),a(2,"Repetir Contrase\xF1a"),n(),u(3,"input",16),r(4,"mat-error"),a(5),n()()),t&2){let s=x();l(5),g(" ",s.baseForm.getErrorMessage(s.userForm.get("confirmPassword"))," ")}}var w=function(t){return t.EDIT="edit",t.NEW="new",t}(w||{}),Vt=(()=>{let e=class e{constructor(i,o,m,c,Lt){this.data=i,this.dialogRef=o,this.fb=m,this.baseForm=c,this.usuarioSvc=Lt,this.destroy$=new y,this.titleButton="Guardar",this.actionTODO=w.NEW,this.roles=[],this.userForm=this.fb.group({cveUsuario:[""],nombre:["",[f.required,f.minLength(3)]],apellidos:["",[f.required,f.minLength(3)]],username:["",[f.required,f.minLength(3)]],cveRol:["",[f.required]],password:["",[f.required]],confirmPassword:["",[f.required]]})}ngOnInit(){this.usuarioSvc.listarRoles().pipe(C(this.destroy$)).subscribe(i=>{this.roles=i,this.pathData()})}pathData(){this.data.user.cveUsuario?(this.userForm.patchValue({cveUsuario:this.data?.user.cveUsuario,nombre:this.data?.user.nombre,apellidos:this.data?.user.apellidos,username:this.data?.user.username,cveRol:this.data?.user.cveRol}),this.userForm.get("username")?.disable(),this.userForm.get("password")?.setValidators(null),this.userForm.get("password")?.setErrors(null),this.userForm.get("confirmPassword")?.setValidators(null),this.userForm.get("confirmPassword")?.setErrors(null),this.userForm.updateValueAndValidity(),this.titleButton="Actualizar",this.actionTODO=w.EDIT):(this.titleButton="Guardar",this.actionTODO=w.NEW)}onSave(){if(!this.userForm.invalid){var i=this.userForm.getRawValue();if(this.actionTODO==w.NEW){var o={nombre:i.nombre,apellidos:i.apellidos,username:i.username,password:i.password,cveRol:parseInt(i.cveRol)};this.usuarioSvc.insertarUsuario(o).pipe(C(this.destroy$)).subscribe(c=>{this.dialogRef.close(c)})}else{var m={cveUsuario:parseInt(i.cveUsuario),nombre:i.nombre,apellidos:i.apellidos,cveRol:parseInt(i.cveRol)};this.usuarioSvc.actualizarUsuario(m).pipe(C(this.destroy$)).subscribe(c=>{this.dialogRef.close(c)})}}}ngOnDestroy(){this.destroy$.next({}),this.destroy$.complete()}};e.\u0275fac=function(o){return new(o||e)(h(Ut),h(It),h(at),h(kt),h(R))},e.\u0275cmp=O({type:e,selectors:[["app-usuario-dialog"]],decls:39,vars:9,consts:[["mat-dialog-title",""],[3,"submit","formGroup"],["appearance","outline",1,"full-width"],["type","text","formControlName","nombre","matInput",""],["type","text","formControlName","apellidos","matInput",""],["type","text","formControlName","username","matInput",""],["formControlName","cveRol"],[3,"value",4,"ngFor","ngForOf"],["class","full-width","appearance","outline",4,"ngIf"],["align","center"],["type","button","mat-flat-button","","color","warn",1,"me-2"],["type","submit","mat-flat-button","","color","primary"],["align","end"],["mat-button","","mat-dialog-close",""],[3,"value"],["type","password","formControlName","password","matInput",""],["type","password","formControlName","confirmPassword","matInput",""]],template:function(o,m){o&1&&(r(0,"h1",0),a(1,"Usuario"),n(),r(2,"mat-dialog-content")(3,"form",1),v("submit",function(){return m.onSave()}),r(4,"mat-form-field",2)(5,"mat-label"),a(6,"Nombre"),n(),u(7,"input",3),r(8,"mat-error"),a(9),n()(),r(10,"mat-form-field",2)(11,"mat-label"),a(12,"Apellidos"),n(),u(13,"input",4),r(14,"mat-error"),a(15),n()(),r(16,"mat-form-field",2)(17,"mat-label"),a(18,"Nombre de Usuario"),n(),u(19,"input",5),r(20,"mat-error"),a(21),n()(),r(22,"mat-form-field",2)(23,"mat-label"),a(24,"Rol(es)"),n(),r(25,"mat-select",6),d(26,Gt,2,2,"mat-option",7),n(),r(27,"mat-error"),a(28),n()(),d(29,Wt,6,1,"mat-form-field",8)(30,Qt,6,1,"mat-form-field",8),r(31,"div",9)(32,"button",10),a(33," Limpiar "),n(),r(34,"button",11),a(35),n()()()(),r(36,"mat-dialog-actions",12)(37,"button",13),a(38," Cerrar "),n()()),o&2&&(l(3),p("formGroup",m.userForm),l(6),g(" ",m.baseForm.getErrorMessage(m.userForm.get("nombre"))," "),l(6),g(" ",m.baseForm.getErrorMessage(m.userForm.get("apellidos"))," "),l(6),g(" ",m.baseForm.getErrorMessage(m.userForm.get("username"))," "),l(5),p("ngForOf",m.roles),l(2),g(" ",m.baseForm.getErrorMessage(m.userForm.get("cveRol"))," "),l(),p("ngIf",m.actionTODO=="new"),l(),p("ngIf",m.actionTODO=="new"),l(5),g(" ",m.titleButton," "))},dependencies:[z,G,ot,tt,et,it,rt,nt,Tt,Rt,Nt,Pt,U,pt,lt,st,yt,J,ct]});let t=e;return t})();var Jt=()=>[5,10,20,100];function Kt(t,e){t&1&&(r(0,"th",16),a(1," Nombre "),n())}function Xt(t,e){if(t&1&&(r(0,"td",17),a(1),n()),t&2){let s=e.$implicit;l(),S(s.nombre)}}function Yt(t,e){t&1&&(r(0,"th",16),a(1," Apellidos "),n())}function Zt(t,e){if(t&1&&(r(0,"td",17),a(1),n()),t&2){let s=e.$implicit;l(),S(s.apellidos)}}function te(t,e){t&1&&(r(0,"th",16),a(1," Nombre de Usuario "),n())}function ee(t,e){if(t&1&&(r(0,"td",17),a(1),n()),t&2){let s=e.$implicit;l(),S(s.username)}}function ie(t,e){t&1&&(r(0,"th",16),a(1," Rol(es) "),n())}function oe(t,e){if(t&1&&(r(0,"td",17),a(1),n()),t&2){let s=e.$implicit;l(),S(s.rol.descripcion)}}function re(t,e){t&1&&u(0,"th",16)}function ne(t,e){if(t&1){let s=V();r(0,"td",18)(1,"button",19),v("click",function(){let o=N(s).$implicit,m=x();return $(m.onOpenModal(o))}),r(2,"mat-icon"),a(3,"edit"),n(),a(4," Editar "),n(),r(5,"button",20),v("click",function(){let o=N(s).$implicit,m=x();return $(m.onDelete(o.cveUsuario))}),r(6,"mat-icon"),a(7,"delete"),n(),a(8," Eliminar "),n()()}}function ae(t,e){t&1&&u(0,"tr",21)}function me(t,e){t&1&&u(0,"tr",22)}var Bt=(()=>{let e=class e{constructor(i,o){this.dialog=i,this.usuarioSvc=o,this.destroy$=new y,this.dataSource=new wt,this.displayedColumns=["nombre","apellidos","username","rol","acciones"]}ngOnInit(){this.listar()}listar(){this.usuarioSvc.listarUsuarios().pipe(C(this.destroy$)).subscribe(i=>{this.dataSource.data=i})}ngAfterViewInit(){this.dataSource.paginator=this.paginator}onOpenModal(i={}){this.dialog.open(Vt,{maxWidth:"100%",width:"80%",data:{user:i}}).afterClosed().pipe(C(this.destroy$)).subscribe(m=>{m&&this.listar()})}onDelete(i){this.usuarioSvc.eliminarUsuario(i).pipe(C(this.destroy$)).subscribe(o=>{this.listar()})}ngOnDestroy(){this.destroy$.next({}),this.destroy$.complete()}};e.\u0275fac=function(o){return new(o||e)(h(Ft),h(R))},e.\u0275cmp=O({type:e,selectors:[["app-usuarios"]],viewQuery:function(o,m){if(o&1&&B(F,5),o&2){let c;q(c=L())&&(m.paginator=c.first)}},decls:27,vars:5,consts:[[1,"m-3"],["align","right"],["mat-flat-button","","color","primary",1,"m-2",3,"click"],[1,"table-content","mat-elevation-z8","m-4"],["mat-table","",3,"dataSource"],["matColumnDef","nombre"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","apellidos"],["matColumnDef","username"],["matColumnDef","rol"],["matColumnDef","acciones"],["mat-cell","","class","text-center",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"pageSizeOptions"],["mat-header-cell",""],["mat-cell",""],["mat-cell","",1,"text-center"],["mat-flat-button","","color","accent",1,"me-2",3,"click"],["mat-flat-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(o,m){o&1&&(r(0,"h3",0),a(1,"Usuarios"),n(),r(2,"div",1)(3,"button",2),v("click",function(){return m.onOpenModal()}),r(4,"mat-icon"),a(5,"add"),n(),a(6," Agregar "),n()(),r(7,"div",3)(8,"table",4),b(9,5),d(10,Kt,2,0,"th",6)(11,Xt,2,1,"td",7),M(),b(12,8),d(13,Yt,2,0,"th",6)(14,Zt,2,1,"td",7),M(),b(15,9),d(16,te,2,0,"th",6)(17,ee,2,1,"td",7),M(),b(18,10),d(19,ie,2,0,"th",6)(20,oe,2,1,"td",7),M(),b(21,11),d(22,re,1,0,"th",6)(23,ne,9,0,"td",12),M(),d(24,ae,1,0,"tr",13)(25,me,1,0,"tr",14),n(),u(26,"mat-paginator",15),n()),o&2&&(l(8),p("dataSource",m.dataSource),l(16),p("matHeaderRowDef",m.displayedColumns),l(),p("matRowDefColumns",m.displayedColumns),l(),p("pageSizeOptions",H(4,Jt)))},dependencies:[Y,F,ft,gt,Mt,Ct,ht,vt,_t,bt,xt,Et,U],styles:["h3[_ngcontent-%COMP%]{margin:8px 0;font-size:1.5rem;font-weight:500;color:#333}div[align=right][_ngcontent-%COMP%]{margin-bottom:16px}div[align=right][_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;align-items:center}div[align=right][_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-left:8px}.table-content[_ngcontent-%COMP%]{padding:16px;border-radius:8px;background-color:#fff}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600;text-align:left;padding:12px;background-color:#f5f5f5}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px;border-bottom:1px solid #e0e0e0}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td.text-center[_ngcontent-%COMP%]{text-align:center}mat-paginator[_ngcontent-%COMP%]{margin-top:16px}button.mat-flat-button.me-2[_ngcontent-%COMP%]{margin-right:8px}button.mat-flat-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-left:4px}.mb-2[_ngcontent-%COMP%]{margin-bottom:8px}.mb-4[_ngcontent-%COMP%]{margin-bottom:16px}"]});let t=e;return t})();var le=[{path:"",component:Bt}],qt=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=I({type:e}),e.\u0275inj=D({imports:[k.forChild(le),k]});let t=e;return t})();var Xe=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=I({type:e}),e.\u0275inj=D({imports:[W,qt,jt,Z,mt,Ot,St,$t,K,ut,Dt,dt]});let t=e;return t})();export{Xe as UsuariosModule};
